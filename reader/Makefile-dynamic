CC = gcc

# set XEDPATH to the directory containing XED
XEDPATH = ../xed

CFILES =  ../shared/XedLynxReg.c ../shared/LynxReg.c ../shared/XedDisassembler.c Buf.c ReaderUtils.c ShadowMemory.c ShadowRegisters.c DataOpsReader.c Verify.c Reader.c
OFILES = $(CFILES:c=o)
CFLAGS = -Wall -O2 -g -fpic -c
INCLUDES = -I$(XEDPATH)/include/public/xed -I$(XEDPATH)/obj -I../shared -I../reader
LDFLAGS = -shared -g -L$(XEDPATH)/obj
LIBS = -lxed

%.o: %.c
	$(CC) $(CFLAGS) $(INCLUDES) -o $@ $<

libtrd.so: $(OFILES)
	$(CC) $(LDFLAGS) -o $@ $^ $(LIBS)

.PHONY: clean
clean:
	rm -f ../shared/*.o *.o libtrd.so
